{% extends 'main/base.html' %}

{% load static %}

{% block title %}
Crawler "{{ crawler.source_name }}"
{% endblock %}

{% block content %}
<div class="container" id="body-row" style="margin: 15px">
    <!-- Global details -->
    <div class="row">
        <div class="col">
            <h3>{{ crawler.source_name }}</h3>
            <h4>Details</h4>
            <ul>

                <li>Nome do coletor: <strong>{{ crawler.source_name }}</strong></li>
                <li>ID do coletor: <strong>{{ crawler.id }}</strong></li>
                <li>URL base: <strong>{{ crawler.base_url }}</strong></li>
                <li>Data de criação: <strong>{{ crawler.creation_date }}</strong></li>
                <li id="crawler_ status">Status:
                {% if crawler.running == True %}
                  <span class="badge badge-success">Rodando</span>
                {% elif crawler.running == False %}
                  <span class="badge badge-warning">Parado</span>
                {% endif %}
                </li>
                <!-- <li id="status_badge">Status: <img src="{% static 'gif/loading-png-gif.gif' %}" style="height: 15px"></li> -->
            </ul>
        </div>
    </div>

    <div class="row" style="display: none">
    <!-- <div class="row"> -->
        <div class="col" id="crawler_id">
            {{crawler.id}}
        </div>
        <div class="col" id="last_instance_id">
            {% if last_instance is not None %}
                {{last_instance.instance_id}}
            {% else %}
                Nenhum
            {% endif %}
        </div>
        <div class="col" id="instance_running">
            {{crawler.running}}
        </div>
    </div>

    {% if last_instance is not None %}
    <!-- Instances table -->
    <div class="row">
        <div class="col">
            <h4>Instances:</h4>
            <table class="table" id="instances_table">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Iniciado em</th>
                        <th scope="col">Última atualização</th>
                        <th scope="col">Arquivo de configurações</th>
                        <th scope="col">Arquivo de dados</th>
                    </tr>
                </thead>
                <tbody>
                    {% for instance in instances %}
                    <tr>
                        <td>{{instance.instance_id}}</td>
                        <td>{{instance.creation_date}}</td>
                        <td>{{instance.last_modified}}</td>
                        <td><button type="button" class="btn btn-primary">Abrir</button></td>
                        <td><button type="button" class="btn btn-primary">Abrir</button></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="row">
        <div class="col">
            <h5>Nenhuma instância criada.</h5>
        </div>
    </div>
    {% endif %}

    <!-- Run/Stop/Del/Edit Buttons -->
    <div class="row">
        <div class="col">
            {% if crawler.running == True %}

            <a id="runBtn" class="btn btn-success disabled"
                dataref="{% url 'run_crawl' crawler.id %}" >Começar</a>
            <a id="stopBtn" class="btn btn-danger"
                href="{% url 'stop_crawl' crawler.id %}">Parar</a>
            {% elif crawler.running == False %}
            <a id="runBtn" class="btn btn-success"
                href="{% url 'run_crawl' crawler.id %}">Começar</a>
            <a id="stopBtn" class="btn btn-danger disabled"
                dataref="{% url 'stop_crawl' crawler.id %}">Parar</a>

            {% endif %}
            <!-- <a class="btn btn-success" id="run_button">
                <img src="{% static 'gif/loading-png-gif.gif' %}" style="height: 25px">
            </a>
            <a class="btn btn-danger" id="stop_button">
                <img src="{% static 'gif/loading-png-gif.gif' %}" style="height: 25px">
            </a> -->
            <a class="btn btn-info" href="{% url 'edit_crawler' crawler.id %}" class="btn btn-primary">Editar</a>
            <a class="btn btn-secondary" href="{% url 'delete_crawler' crawler.id %}">Excluir</a>
        </div>
    </div>

    {% if last_instance is not None %}
    <!-- Log header -->
    <div class="row" style="margin-top: 15px;">
        <div class="col">
            <h4>Logs da última instância</h4>
        </div>
        <td><a class="btn btn-primary" href="{% url 'raw_log' last_instance.instance_id %}">Abrir Log Bruto</a></td>
    </div>

    <!-- Tail stdout -->
    <div class="row">
        <div class="col">
            <div class="row"><div class="col"><h5>Últimas linhas do stdout</h5></div></div>
            <div class="row">
                <pre class="col" style="border: 1px solid gray" id="stdout_tail">
                    Arquivo em branco.
                </pre>
            </div>
            <div class="row"><div class="col"><i id="stdout_tail_update">Última atualização: 07/06/2020 11:09</i></div></div>
        </div>
    </div>
    <br>
    <!-- Tail stderr -->
    <div class="row">
        <div class="col">
            <div class="row"><div class="col"><h5>Últimas linhas do stderr</h5></div></div>
            <div class="row">
                <pre class="col" style="border: 1px solid gray" id="stderr_tail">
                    Arquivo em branco.
                </pre>
            </div>
            <div class="row"><div class="col"><i id="stderr_tail_update">Última atualização: 07/06/2020 11:09</i></div></div>
        </div>
    {% endif %}
</div>
{% endblock %}


{% block js %}
<script src="{% static 'js/details.js' %}"></script>
{% endblock %}
